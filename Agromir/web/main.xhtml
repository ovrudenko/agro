<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <h:head>
    </h:head>
    <h:body>
        <h:form >
            <table width="100%">
                <tr>
                    <td align="right">
                        <h:panelGroup>
                            <p:outputPanel id="agroForm">
                                <h:panelGrid id="none"  columns="3" rendered="#{registrationUserBean.idUser==0}">
                                    <h:outputLink id="loginLink" value="javascript:void(0)" onclick="PF('dlg').show()" title="Вход"  >
                                        <h:outputText value="Вход"/>
                                    </h:outputLink>  
                                    |
                                    <h:commandLink value="Регистрация" action="registration" />
                                    <ui:remove>
                                        <h:outputLink id="registry" value="javascript:void(0)" onclick="PF('dlg2').show()" title="Регистрация" >
                                            <h:outputText value="Регистрация"/>
                                        </h:outputLink>
                                    </ui:remove>
                                </h:panelGrid>

                                <h:panelGrid id="auth" columns="3" rendered="#{registrationUserBean.idUser!=0}">
                                    <h:commandLink id="loginName">
                                        <h:outputText value="#{registrationUserBean.login}"/>
                                    </h:commandLink>
                                    |
                                    <p:commandLink id="exit" action="#{registrationUserBean.exit}" update="agroForm" >
                                        <h:outputText value="Выход"/>
                                    </p:commandLink>
                                </h:panelGrid>
                            </p:outputPanel>

                            <!--     <p:growl id="growl" showDetail="true" life="3000" />-->
                            <p:growl id="growlReg" showDetail="true" life="3000" />
                            <p:dialog id="dialog" header="Вход в систему" widgetVar="dlg" resizable="false" >  

                                <h:panelGrid id="loginGrid" columns="2" cellpadding="5">  

                                    <h:outputLabel for="username" value="Логин:" />  
                                    <p:inputText value="#{registrationUserBean.login}"   
                                                 id="enterUsername" required="false" label="username" />  

                                    <h:outputLabel for="password" value="Парль:" />  
                                    <h:inputSecret value="#{registrationUserBean.password}"   
                                                   id="enterPassword" required="false" label="password" />  

                                    <f:facet name="footer">  
                                        <p:commandButton id="loginButton" value="Войти" update="agroForm, growlReg, panelReg" 
                                                         actionListener="#{registrationUserBean.enter}"   
                                                         oncomplete="handleLoginRequest(xhr, status, args)" >  

                                        </p:commandButton>
                                    </f:facet> 

                                </h:panelGrid>  

                            </p:dialog> 
                        </h:panelGroup>

                        <p:outputPanel rendered="#{registrationUserBean.registry}" id="panelReg">
                            <ui:remove>
                                <p:growl id="growl" showDetail="true" life="3000" />
                                <p:dialog id="dialogReg" header="Регистрация нового пользователя" widgetVar="dlg2" resizable="false" modal="true" >

                                    <h:panelGrid columns="2" cellpadding="5" id="regGrid">
                                        <h:outputLabel for="username" value="Логин:" />  
                                        <p:inputText value="#{registrationUserBean.login}"   
                                                     id="username" required="false" label="username" />  

                                        <f:facet name="footer">  
                                            <p:commandButton id="regButton" value="Регистрация" update="regGrid"
                                                             actionListener="#{registrationUserBean.registration}"   
                                                             oncomplete="handleRegistryRequest(xhr, status, args)" />  
                                            <p:commandButton id="cancel" value="Отмена" onclick="closeReg();"/>
                                        </f:facet>  
                                    </h:panelGrid>  

                                </p:dialog> 
                            </ui:remove>
                        </p:outputPanel>

                    </td>
                </tr>
            </table>   
            <table width="100%">
                <tr>
                    <td align="left">
                        <h:panelGrid columns="2">
                            <h:dataTable value="#{mainPageBean.gropedTypes}" var="types">
                                <h:column>
                                    <!-- column header -->
                                    <f:facet name="header">Тип</f:facet>
                                    <!-- row record -->
                                    #{types.name}
                                </h:column>
                                <h:column>
                                    <!-- column header -->
                                    <f:facet name="header">Количество</f:facet>
                                    <!-- row record -->
                                    #{types.count}
                                </h:column>
                            </h:dataTable>

                        </h:panelGrid>
                    </td>
                    <td>
                        <h:panelGrid columns="1">
                            <h:outputLabel>Поиск по объявлениям </h:outputLabel>

                            <h:inputText value="Введите ключевое слово для поиска" size="50"></h:inputText>
                            <h:selectOneRadio layout="horisontal">
                                <f:selectItem itemLabel="Куплю"></f:selectItem>
                                <f:selectItem itemLabel="Продам"></f:selectItem>
                            </h:selectOneRadio>
                            <h:commandButton value="Поиск"></h:commandButton>
                            <h:commandLink rendered="#{registrationUserBean.idUser!=0}" value="Создать новое объявление"></h:commandLink>
                        </h:panelGrid>
                    </td>
                    <td>
                        <h:outputLabel>Статистика сайта</h:outputLabel>
                        <br/>
                        <table>
                            <tr>
                                <th></th>
                                <th></th>                    
                            </tr>
                            <tr>
                                <td>Новых объявлений</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>Новых пользователей</td>
                                <td>80</td>
                            </tr>
                        </table>
                    </td>

                </tr>
                <tr>
                    <!--  <td></td>
                      <td>${mainPageBean.advertText}</td>
                      <td><8885dddddddddddddddddddddddddddddddddddddddddddddddddddd8    ilh/td>-->
                    <h:dataTable rows="10" value="#{mainPageBean.lastAddedAdverts}" var="o">
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">Объявление</f:facet>
                            <!-- row record -->
                            #{o.text}
                        </h:column>
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header">Дата добавления</f:facet>
                            <!-- row record -->
                            #{o.dateCreate}
                        </h:column>
                    </h:dataTable>
                </tr>
                <tr><td></td>
                    <td>Наши контакты...<br/>
                        телефон: 123-45-67 <br/>
                        e-mail: argo@mail.ru</td>
                    <td></td></tr>
            </table>
        </h:form>
        <script type="text/javascript">  
            function handleLoginRequest(xhr, status, args) {  
                if(!args.auth) {  
                    PF('dlg').jq.effect("shake", { times:5 }, 100);  
                }   
                else {  
                    PF('dlg').hide();  
                    $('#loginLink').fadeOut(); 
                    $('#none').show();
                    $('#auth').show();
                }  
            }  
            
            function handleRegistryRequest(xhr, status, args) {  
                if(!args.auth) {  
                    PF('dlg2').jq.effect("shake", { times:5 }, 100);  
                }   
                else {  
                    PF('dlg2').hide();  
                    $('#regestry').fadeOut();  
                }  
            }
            
            function closeReg(){
                PF('dlg2').hide();  
                $('#regestry').fadeOut();
            }
            
            function closeAuth(){
                PF('dlg').hide();  
                $('#loginLink').fadeOut();
            }
        </script>  
    </h:body>
</html>

